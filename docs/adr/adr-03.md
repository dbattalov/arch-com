# Здесь должно быть название ADR
<!-- Название ADR состоит из [ADR.###] [Коротко суть принятого решения] -->
[ADR.03][Заменя БД при пере позиционировании “HelloConf” в LMS систему]


* Статус: Принято
* Владелец: dbattalov@mtsbank.ru


## Контекст
<!-- Описание проблемы, требующей решения, причин, побудивших принять решение, ограничений, действовавших на момент принятия решения -->
Маркетинг решил заняться позиционированием продукта “HelloConf” на рынке и хочет применять сервис конференций, как LMS систему. У данных появляются дополнительные атрибуты – план мероприятий, ссылка на материалы, текст домашнего задания и пр. Необходимо проработать варианты замены БД на решение, более пригодное под постоянно меняющуюся структуру и функциональность.    


## Варианты решения
<!-- Описание рассмотренных вариантов c их плюсами и минусами -->
Критерии выбора - наличие компетенций в команде и/или на рынке, масштабируемость решения, динамическое изменения структуры данных, возможность вернуться к текущему функционалу проведения конференций.


### Вариант 1. PostgreSQL
<!-- Описание варианта 1 -->
Остаться и продолжать разработку на реляционной базе данных PostgreSQL.
* **Плюсы**
  * Поддержка транзакций ACID.
  * Возможность хранения в виде JSON.
  * Простота разработки.
  * Наличие экспертизы в команде и наличие специалистов на рынке.
* **Минусы**
  * Сложность развертывания кластерного решения и настройки репликаций.
  * Нет возможность на ходу менять структуру таблиц.
  * Сложность работы с большим объемом.


### Вариант 2. MongoDB
<!-- Описание варианта 2 -->
Перейти с реляционной БД на MongoDB.
* **Плюсы**
  * Техрадар - "Рекомендовано"
  * Гибкость хранения (добавление и модификация новых полей)
  * Поддержка распределенной схемы хранения "из коробки"
  * Наличие специалистов на рынке
  * Скорость работы (чтение-запись)
  * Встроенная валидация документов по JSON-схеме
* **Минусы**
  * Отсутствие экспертизы в команде
  * Нет полной поддержки транзакций ACID
  * Сложность миграции данных в реляционную БД, особенно при неоднократных модификациях структур данных.
  * Есть ряд ограничений, затрудняющие, но не блокирующие: размер документа 16 Мб, не существуют NULL  и т.п.


### Вариант 3. PostgreSQL + MongoDB
<!-- Описание варианта 2 -->
Использовать PostgreSQL для сервисов конференции, а в новых микросервисах, которые будут реализовывать маркетинговые фичи будем использовать MongoDB
* **Плюсы**
  * Техрадар - "Рекомендовано"
  * Поддержка транзакций ACID для основной части.
  * Задействуем плюсы обоих решений.
  * Возможность вернуться к первоначальному состоянию без существенных доработок.
* **Минусы**
  * Усложнение разработки.
  * Поддержка двух типов БД.
  * Отсутствие экспертизы в команде MongoDB
## Решение
<!-- Описание выбранного решения. Решение должно быть сформулировано чётко ("Мы используем...", "Мы не используем", а не "Желательно.." или "Предлагается...").
Должна быть понятна связь между решением и проблемой, почему выбрали именно это решение из вариантов -->
В качестве БД для микросервисов была выбран смешанный вариант использования, а именно: там где целесообразнее использовать реляционную БД, там оставляем PostgreSQL, а под фич-"полет фантазии" Маркетинга будем использовать MongoDB


## Последствия
<!-- Положительные и отрицательные последствия (trade-offs). Арх. решения, которые потребуется принять как следствие принятого решения. Если решение содержит риски, то описано, как с ними планируют поступить (за счет чего снижать, почему принять). -->
Выбранное решение позволит реализовывать и оперативно выводить в "прод" новый функционал с изменяющейся структурой данных в той части системы, которая относится к LMS. В случае решения свернуть направление "Обучение", вернуться к проведению конференции - переход будет "безболезненно". 
